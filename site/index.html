<script>
/* ========================================================
   全域變數
======================================================== */
let DATA = [];
let FILTER_CAT = "";
let FILTER_MECH = "";
const $ = (s)=>document.querySelector(s);

/* ========================================================
   修正版：BasePath 自動偵測 + JSON 載入
   （支援 GitHub Pages 所有部署情況）
======================================================== */
async function loadData(){
  // 自動取得 repo 名（避免 /site/site/）
  const path = window.location.pathname;
  const repoMatch = path.match(/^\/([^\/]+)\//);
  const repo = repoMatch ? repoMatch[1] : "";

  const candidates = [];

  // 1) 與 index.html 同層
  candidates.push("data/games.json");
  candidates.push("./data/games.json");

  // 2) /site/data/
  candidates.push("site/data/games.json");
  candidates.push("./site/data/games.json");

  // 3) GitHub Pages Repo 路徑（例如 /game-guide-site-v2/）
  if(repo){
    candidates.push(`/${repo}/data/games.json`);
    candidates.push(`/${repo}/site/data/games.json`);
  }

  console.log("候選路徑：", candidates);

  for(const url of candidates){
    try{
      const r = await fetch(url);
      if(r.ok){
        DATA = await r.json();
        console.log("載入成功：", url, "rows =", DATA.length);
        buildOptions();
        render();
        return;
      }else{
        console.log("嘗試失敗：", url, r.status);
      }
    }catch(e){
      console.log("錯誤：", url, e);
    }
  }

  alert("無法載入 games.json，請確認資料是否存在於 data/ 或 site/data/");
}
