<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>Board Game Guide</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font:16px/1.5 system-ui;margin:20px}
    .filters{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .card{border:1px solid #ddd;padding:12px;border-radius:10px;background:#fff}
    .card img{width:100%;height:160px;object-fit:cover;border-radius:6px;background:#f7f7f7}
    .row{display:flex;gap:8px;align-items:center}
    .price{font-weight:700}
    .note{font-size:12px;color:#666}
    input,select{padding:6px 8px;border:1px solid #ccc;border-radius:6px}
  </style>
</head>
<body>

<form class="filters" autocomplete="off" onsubmit="return false">
  <input id="q" name="q_no_autofill"
         placeholder="搜尋：中文名 / EN / 關鍵字" style="min-width:200px"
         autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <select id="cat"><option value="">全部分類</option></select>
  <input id="pmin" name="pmin_no_autofill" type="number" placeholder="最低價"
         autocomplete="off" inputmode="numeric" spellcheck="false">
  <input id="pmax" name="pmax_no_autofill" type="number" placeholder="最高價"
         autocomplete="off" inputmode="numeric" spellcheck="false">
  <select id="sort">
    <option value="">排序</option>
    <option value="price">售價（低→高）</option>
    <option value="used">二手價（低→高）</option>
    <option value="weight">策略強度（低→高）</option>
  </select>
</form>

<div id="grid" class="grid"></div>

<script>
  // 避免瀏覽器沿用舊自動完成
  document.getElementById('q').setAttribute('name','q_'+Math.random().toString(36).slice(2));

  let DATA=[];
  const G = document.getElementById("grid"),
        Q = document.getElementById("q"),
        C = document.getElementById("cat"),
        S = document.getElementById("sort"),
        PMIN = document.getElementById("pmin"),
        PMAX = document.getElementById("pmax");

  // 本檔在「根目錄」→ 直接讀 /data
  fetch("data/games_full.json?ts="+Date.now())
    .then(r=>r.json())
    .then(d=>{ DATA=d; init(); });

  // 取用分類：優先中文，否則退回英文
  const getCats = (x) => (x.categories_zh && x.categories_zh.length ? x.categories_zh : (x.categories || []));

  function init(){
    // 下拉分類用中文（若有）
    const cats=[...new Set(DATA.flatMap(getCats))]
      .sort((a,b)=>a.localeCompare(b,'zh-Hant'));
    cats.forEach(c=>{
      const o=document.createElement('option');
      o.value=c; o.textContent=c; C.appendChild(o);
    });
    render();
    [Q,C,S,PMIN,PMAX].forEach(el=>el.addEventListener('input',render));
  }

  function render(){
    let list = DATA.slice();

    // 關鍵字（含中文分類與別名）
    const q = Q.value.trim().toLowerCase();
    if(q){
      list = list.filter(x=>{
        const blob = [
          x.name_zh||"", x.name_en||"",
          ...(x.aliases_zh||[]),
          ...(x.search_keywords||[]),
          ...getCats(x)
        ].join(" ").toLowerCase();
        return blob.includes(q);
      });
    }

    // 分類（用中文或回退的英文）
    const cat = C.value;
    if(cat) list = list.filter(x => getCats(x).includes(cat));

    // 價格區間（售價）
    const pmin = Number(PMIN.value||0), pmax = Number(PMAX.value||0);
    if(pmin>0) list = list.filter(x => (x.price_twd??1e12) >= pmin);
    if(pmax>0) list = list.filter(x => (x.price_twd??1e12) <= pmax);

    // 排序
    if(S.value==="
